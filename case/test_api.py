import json
import ddt
from common.logger import Log
from common import base_api
import unittest
import requests

test_data = [{'method': 'post', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 71, 'if_name': '模拟授权', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/ops', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'json', 'body': {'openid': 'ocIIn4141-6H2uTABfyz5XlTDBGU', 'gender': '1', 'headimg': 'https://coursecdn.xxbmm.com/xxbmm-course-image/2019/05/17/17/ab2ef098-be16-4955-a144-a452815f5418.jpg', 'source': 'APPLET', 'nickname': '道在光明', 'unionid': 'oPmunjjIzQtjk2aBI4pfkVLcA9tE'}}, {'method': 'post', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 41, 'if_name': '创建宝宝', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {'data': ''}, 'data_type': 'json', 'body': {'birthday': '2019-01-22', 'gender': 'MAN', 'name': '小乖乖在此', 'headimg': 'https://coursecdn.xxbmm.com/xxbmm-course-image/2019/06/05/18/65b52d5c-0724-42b2-bb4b-bf4407e84cdf.jpg'}}, {'method': 'get', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 40, 'if_name': '宝宝列表', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {}}, {'method': 'get', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 56, 'if_name': '宝宝是否购买了课程核心课', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/course/buy', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {'baby_id': '$data'}}, {'method': 'get', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 87, 'if_name': '获取已领取试听课宝宝ID, 没有宝宝领取过返回0', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/get_push', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {}}, {'method': 'get', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 103, 'if_name': '获取未购买核心课宝宝ID, 没有宝宝领取过返回0', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/none_core', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {}}, {'method': 'put', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 6, 'if_name': '修改宝宝信息', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/{id}', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'json', 'body': {'birthday': '2017-01-22', 'gender': 'WOMAN', 'name': '大乖乖在此', 'id': '$data', 'headimg': 'https://coursecdn.xxbmm.com/xxbmm-course-image/2019/06/05/18/65b52d5c-0724-42b2-bb4b-bf4407e84cdf.jpg'}}, {'method': 'put', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 58, 'if_name': '修改宝宝生日', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/{id}/birthday', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'json', 'body': {'birthday': '2018-01-22', 'id': '$data'}}, {'method': 'get', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 13, 'if_name': '宝宝是否领取过试听课, 领取过为true', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/{id}/free', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {'id': '$data'}}, {'method': 'delete', 'headers': {'Accept': 'application/json;charset=UTF-8', 'token': 'eyJhbGciOiJIUzI1NiJ9.eyJzdGFydFRpbWUiOjE1NjAxODMyNjkwODgsImV4cGlyZVRpbWUiOjE1NjE0NzkyNjkwODgsImlkZW50aWZ5IjoyMDkxN30.kuV9qLIW8Yeq3Jd_L5t6tBTmVSbTKIca74h3Pmyoxk4'}, 'if_id': 7, 'if_name': '删除宝宝信息', 'case_name': '宝宝接口测试用例', 'url': 'https://course.rest.xxbmm.com/babys/{id}', 'checkpoint': [{'check': 'msg', 'comparator': 'eq', 'expect': '成功'}], 'extract': {}, 'data_type': 'data', 'body': {'id': '$data'}}]
log = Log()  # 初始化log


@ddt.ddt
class Test_api(unittest.TestCase):
	@classmethod
	def setUpClass(cls):
		cls.s = requests.session()

	@ddt.data(*test_data)
	def test_api(self, data):
		"""{0}"""
		res = base_api.send_requests(self.s, data)  # 调用send_requests方法,请求接口,返回结果
		checkpoint = data["checkpoint"]  # 检查点 checkpoint
		res_text = res["text"]  # 返回结果
		text = json.loads(res_text)
		for inspect in checkpoint:
			self.assertTrue(inspect["expect"] in str(text[inspect["check"]]).lower(), "检查点验证失败！")  # 断言


if __name__ == '__main__':
	unittest.main()